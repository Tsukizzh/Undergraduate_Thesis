# Path A 执行进度日志

> **路径名称**: 模型评估测试集构建
> **开始时间**: 2026-01-08
> **目标**: 用158个PDB评估EZSpecificity模型

---

## 基本信息

| 配置项 | 值 |
|--------|-----|
| 起始步骤 | Step 0（从头开始） |
| 配体分类策略 | 自动分类 + 人工审核 |
| GPU显存 | 8-16GB → batch_size=8 |

---

## 执行记录

### Step 0: 确认数据位置并创建工作目录

| 项目 | 状态 |
|------|------|
| 状态 | ✅ 已完成 |
| 开始时间 | 2026-01-08 05:00 |
| 完成时间 | 2026-01-08 05:10 |

**完成内容**:
1. ✅ 创建PathA目录结构
2. ✅ 复制依赖数据到source_data/
3. ✅ 创建README.md说明文件
4. ✅ 创建进度日志

**产出文件**:
- `source_data/01_核心数据/ML训练数据集_186个.csv`
- `source_data/01_核心数据/P450酶列表_最终版389个.csv`
- `source_data/01_核心数据/高质量P450全集_1426个.csv`
- `source_data/01_核心数据/全部P450结构_1591个_物种修复后.csv`
- `source_data/02_底物数据/P450酶底物反应详表_*.csv`
- `source_data/03_物种分类/按物种分类/*.csv`
- `source_data/04_PDB映射/*.csv`
- `source_data/05_验证数据/非P450酶列表_24815个.csv`
- `source_data/README.md`

---

### Step 1: 下载PDB文件

| 项目 | 状态 |
|------|------|
| 状态 | ✅ 已完成 |
| 开始时间 | 2026-01-08 |
| 完成时间 | 2026-01-08 |

**数据分析（Codex验证）**:
- 原始数据：186条记录，185个唯一PDB
- 排除记录：26个PDB（25个P450的UniProt ID与ESIBank重叠，其中7M8I是P450-Adrenodoxin复合物）
- 数据清洗：移除1个非P450（6ZZX是Photosystem I）
- 最终下载：158个结构文件

**完成内容**:
1. ✅ 下载154个.pdb格式文件
2. ✅ 下载5个.cif格式文件（7QAN, 8VK6, 9CV8, 9KPU, 9MS2）
3. ✅ 生成排除列表和错误日志

**产出文件**:
- `data/00_raw/pdb_files/*.pdb` (153个，清洗后)
- `data/00_raw/pdb_files/*.cif` (5个)
- `logs/excluded_pdbs.csv`
- `scripts/step1_download_pdb.py`

### Step 2: 提取酶序列

| 项目 | 状态 |
|------|------|
| 状态 | ✅ 已完成 |
| 开始时间 | 2026-01-09 |
| 完成时间 | 2026-01-09 |

**技术方案（修正后）**:
- ~~从PDB文件提取序列~~ → 使用源数据sequence列（RCSB API完整序列）
- 原因：PDB文件中的observed sequence可能缺少未解析的N/C端残基
- 验证：150/158个序列长度不一致，提取序列普遍更短
- 修正：直接使用源数据中的deposited sequence，确保完整性

**数据清洗**:
- 发现20个title不含P450关键词的记录
- Codex验证：18个是P450（特殊命名），2个非P450
- 移除6ZZX（Photosystem I，RCSB注释错误）
- 保留8D8P（fatty acid decarboxylase是P450家族）

**完成内容**:
1. ✅ 从源数据提取158条序列（按PDB文件名排序）
2. ✅ 生成Enzymes.csv（158条，RCSB完整序列）
3. ✅ 生成PDB ID对应关系审计文件
4. ✅ 更新源数据（186→184条）

**产出文件**:
- `data/01_processed/Enzymes.csv` - 158条序列
- `reports/tables/step2_pdb_sequence_mapping.csv` - **PDB ID对应关系**
- `reports/tables/step2_sequence_extraction_report.csv` - 原始提取报告（已弃用）
- `scripts/step2_extract_sequence.py` - 原始提取脚本（已弃用）

**序列统计**:
- 长度范围：368-786 氨基酸
- 平均长度：437 氨基酸

### Step 3: 提取配体信息

| 项目 | 状态 |
|------|------|
| 状态 | ✅ 已完成 |
| 开始时间 | 2026-01-09 |
| 完成时间 | 2026-01-09 |

**技术方案（Codex+Gemini审查）**:
- 使用PDB Chemical Component Dictionary (CCD) API获取SMILES
- 存储isomeric SMILES（立体化学重要）
- 三层过滤：黑名单→关键词分类→人工审核

**配体分类**:
| 分类 | 数量 | 说明 |
|------|------|------|
| substrate | 48 | 底物关键词匹配 |
| inhibitor | 24 | 抑制剂关键词匹配 |
| unknown | 88 | 待确认 |
| exclude | 16 | 缓冲液/离子/溶剂 |

**完成内容**:
1. ✅ 从CCD API获取134个配体SMILES
2. ✅ 配体分类（排除16个非底物）
3. ✅ 生成Substrates.csv（125个唯一SMILES）
4. ✅ 生成配体映射文件（160个有效对）

**产出文件**:
- `data/01_processed/Substrates.csv` - 125个唯一SMILES
- `data/01_processed/step3_ligand_mapping.csv` - 176对映射（含分类）
- `data/01_processed/ligand_smiles_cache.json` - CCD API缓存

**⚠️ 待决策问题：一个酶有多个配体**

有些PDB结构同时结合了多个配体（如6WGW同时有樟脑CAM和它的产物CAH）。
- 当前：158个PDB → 160个有效酶-配体对
- 问题：产物/洗涤剂不应该被当作"底物"

**三种解决方案**：

| 方案 | 核心思路 | 数据量 | 速度 | 状态 |
|------|----------|--------|------|------|
| **A** | 严格筛选（只用共晶底物） | ~80-100 | 中等 | 待执行 |
| **B** | 多配体展开（直接使用） | 160 | 最快 | ✅ **当前执行** |
| **C** | 虚拟对接（ESIBank风格） | 可扩展 | 最慢 | 待执行 |

**执行计划**：B → A → C（先快后慢，逐步对比）

详见：`sessions/2026-01-09_Step3_提取配体信息/session_log.md` 第九章

**🔍 重要发现：ESIBank vs 我们的流程对比**

Codex深度分析揭示了根本性区别：

| 方面 | ESIBank | 我们 |
|------|---------|------|
| 数据流 | **关系优先→结构其次** | **结构优先→关系推断** |
| 起点 | BRENDA酶-底物关系 | PDB实验结构 |
| 对接 | 一次一个底物 | 直接使用PDB配体 |

**结论**：我们遇到的"多配体"问题是使用实验结构的**必然结果**，需要通过配体角色标注解决。

详见：`sessions/2026-01-09_Step3_提取配体信息/session_log.md` 第八章

### Step 4: 构建索引表
- 状态：⏳ 待开始

### Step 5: 转换PDB格式
- 状态：⏳ 待开始

### Step 6: 生成酶特征 (ESM-2)
- 状态：⏳ 待开始

### Step 7: 生成底物特征
- 状态：⏳ 待开始

### Step 8: 处理结构特征
- 状态：⏳ 待开始

### Step 9: 运行EZSpecificity预测
- 状态：⏳ 待开始

### Step 10: 分析预测结果
- 状态：⏳ 待开始

---

## 关键检查点

| 检查点 | 预期值 | 实际值 | 状态 |
|--------|--------|--------|------|
| PDB文件数量 | 158 | 158 | ✅ |
| Enzymes.csv行数 | 158 | 158 | ✅ |
| Substrates.csv行数 | ~100-150 | 125 | ✅ |
| data.csv行数 | ~150-200 | - | ⏳ |
| 高质量结构ID数 | >100 | - | ⏳ |

---

**文档版本**: v1.1 | **最后更新**: 2026-01-09
