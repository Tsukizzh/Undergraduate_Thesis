# P450酶识别结果报告（第五次校正）

# ⚠️⚠️⚠️ 本报告已过时 ⚠️⚠️⚠️

## 重要警告（2026-01-02）

**本报告基于EC号筛选方法，已被证明是根本性错误的！**

**问题根源**：
- data.csv中的`ecnumber`字段表示**反应分类**，不是**酶分类**
- EC号筛选捕获了大量"恰好催化1.14.14类反应"的非P450酶
- 假阳性率约**90%**

**错误数据**：
- ~~4,121个P450酶~~ → **仅389个真正的P450**
- ~~778个模型未见过的P450~~ → 需基于389个重新计算

**正确报告请参考**：
- `../2026-01-02_01-46_P450精确验证/P450精确验证报告.md`
- `../2026-01-02_01-46_P450精确验证/true_p450_enzymes_clean.csv`（389个真正P450）

---

**以下内容仅作为历史记录保留，数据已过时：**

---

## 报告时间
2025-12-31 04:30（第五次校正版）

## ⚠️ 重要校正说明

### 第五次校正（2025-12-31 04:30）

**问题**：之前将halogenase数据集中14个EC 1.14.14.-的酶错误地识别为P450酶。

**实际情况**：
- 这14个UniProt ID中，**13个是FAD依赖型卤化酶（FAD-dependent halogenase）**，其活性中心是黄素（FAD）而非P450的血红素（Heme）
- 第14个（G3FLZ7）是数据噪音，属于无关的锌指蛋白
- EC 1.14.14是一个广泛的分类，不仅包括P450单加氧酶，还包括其他类型的单加氧酶

**校正内容**：
- 删除所有halogenase相关的P450统计
- 仅保留brenda数据源的P450统计
- 更新P450_in_training_set.csv（删除14个错误条目）

### 第四次校正（2025-12-31 04:00）

**问题**：之前统计"模型从未见过的P450酶"时，558+242=800，未考虑测试集与验证集之间存在22个重叠的P450酶。

**校正内容**：去重后正确数字为 **778** 个

### 第三次校正（2025-12-31 03:30）

**问题**：之前只统计了训练集的独特P450酶数量，未统计测试集和验证集。

**校正内容**：补充完整的测试集/验证集独特P450酶统计及重叠分析。

### 第二次校正（2025-12-31 03:10）

**问题**：遗漏了small_family目录的分析。

**校正内容**：检查了所有8个数据源。（注：后经第五次校正确认，halogenase中的EC 1.14.14.-酶并非P450）

### 第一次校正（2025-12-31 02:47）

**问题**：错误使用了 `brenda/all_split/` 目录的数据。

**校正内容**：改用正确的 `brenda/random_split/` 目录数据。

---

## 一、执行摘要

### 核心发现

**EZSpecificity的训练数据中确实包含P450酶！**

| 数据源 | 训练集P450条目 | 训练集独特P450酶 |
|--------|---------------|-----------------|
| brenda | 11,809 | 4,121 |

### 完整统计（第五次校正版 - 仅brenda）

| 数据集 | P450条目 | 独特P450酶 | 与训练集重叠 | 训练集未见 |
|--------|---------|-----------|-------------|-----------|
| **训练集** | 11,809 | 4,121 | - | - |
| 测试集 | 2,705 | 1,565 | 1,007 | **558** |
| 验证集 | 1,181 | 833 | 591 | **242** |

### 关键发现：数据集重叠分析

**重要发现**：训练集、测试集、验证集之间存在P450酶的重叠！

- **测试集**中1,565个独特P450酶中，有1,007个（64.3%）**已在训练集出现过**
- **验证集**中833个独特P450酶中，有591个（70.9%）**已在训练集出现过**

**模型从未见过的P450酶**：
- 测试集：558个
- 验证集：242个
- **合计：778个**（558+242去重后，可用于公平benchmark）

### 对Benchmark的影响

由于训练集中包含 **4,121个独特的P450酶**（仅brenda数据源），使用EZSpecificity对苄基异喹啉生物碱相关P450进行benchmark时：

1. **必须检查目标P450是否在训练集中**
2. **若目标P450的UniProt ID出现在 `P450_in_training_set.csv` 中，则不应用于benchmark**
3. **只有训练集中未见过的P450酶才能用于公平的benchmark测试**
4. **测试集/验证集中有778个P450酶模型从未见过（去重后），可作为潜在benchmark候选**

---

## 二、数据来源确认

### 2.1 模型配置文件

配置文件：`saved_model/model/run_0/complete-full-random-all-0-complex.yml`

```yaml
train_data_path:
  - .../brenda/final_data/random_split/training_datas_0.csv  # 含P450
  - .../small_family/Duf/random_split/training_datas_0.csv
  - .../small_family/Esterase/random_split/training_datas_0.csv
  - .../small_family/Gt_acceptor/random_split/training_datas_0.csv
  - .../small_family/Nitrilase/random_split/training_datas_0.csv
  - .../small_family/Phosphatase/random_split/training_datas_0.csv
  - .../small_family/Thiolase/random_split/training_datas_0.csv
  - .../small_family/halogenase/random_split/training_datas_0.csv  # 不含真正的P450
```

### 2.2 实际使用的数据文件（8个数据源）

| 数据源 | 含P450？ | 说明 |
|--------|---------|------|
| brenda/random_split/ | ✅ 是 | **4,121个P450酶** |
| small_family/Duf/ | ❌ 否 | 功能未知蛋白 |
| small_family/Esterase/ | ❌ 否 | 酯酶（EC 3.1.x.x） |
| small_family/Gt_acceptor/ | ❌ 否 | 糖基转移酶（EC 2.4.x.x） |
| small_family/Nitrilase/ | ❌ 否 | 腈水解酶（EC 3.5.5.x） |
| small_family/Phosphatase/ | ❌ 否 | 磷酸酶（EC 3.1.3.x） |
| small_family/Thiolase/ | ❌ 否 | 硫解酶（EC 2.3.1.x） |
| small_family/halogenase/ | ❌ 否 | **FAD依赖型卤化酶，非P450** |

### 2.3 关于halogenase的说明（第五次校正）

halogenase数据集中有14个酶的EC号为`1.14.14.-`，但经验证：
- **这些不是P450酶**
- 它们是**FAD依赖型卤化酶**，使用黄素（FAD）作为辅因子
- 真正的P450酶使用**血红素（Heme）**作为辅因子
- EC 1.14.14是一个广泛的分类，包含多种单加氧酶类型

---

## 三、P450识别方法

### 3.1 识别依据

P450酶（细胞色素P450单加氧酶）的EC号特征：
- `EC 1.14.14.*` — 以成对供体作用的单加氧酶
- `EC 1.14.15.*` — 以NADH/NADPH为供体的单加氧酶

### 3.2 识别方法

```python
p450_mask = ecnumber.str.match(r'^1\.14\.14\.|^1\.14\.15\.')
```

### 3.3 方法可靠性

**可靠性评级：高（仅限brenda数据源）**

- brenda数据源的P450识别基于BRENDA数据库的EC号标注，可靠性高
- 其他数据源（如halogenase）需要额外验证，因为EC 1.14.14不专指P450

---

## 四、详细统计数据

### 4.1 brenda数据集规模（fold 0 - 模型实际使用）

| 数据集 | 总条目数 | P450条目 | 占比 | 独特P450酶 | 与训练集重叠 | 训练集未见 |
|--------|---------|----------|------|-----------|-------------|-----------|
| data.csv（全量） | 586,515 | 15,695 | 2.68% | 4,899 | - | - |
| 训练集（fold 0） | 439,887 | 11,809 | 2.69% | 4,121 | - | - |
| 测试集（fold 0） | 102,640 | 2,705 | 2.64% | 1,565 | 1,007 | 558 |
| 验证集（fold 0） | 43,988 | 1,181 | 2.69% | 833 | 591 | 242 |

### 4.2 所有fold的P450统计（补充信息）

**说明**：模型（run_0）只使用了fold 0训练，以下为其他fold的参考统计。

| Fold | 训练集P450条目 | 训练集独特P450酶 | 测试集P450条目 | 测试集独特P450酶 | 验证集P450条目 | 验证集独特P450酶 |
|------|---------------|-----------------|---------------|-----------------|---------------|-----------------|
| **fold 0** | **11,809** | **4,121** | **2,705** | **1,565** | **1,181** | **833** |
| fold 1 | 11,773 | 4,098 | 2,706 | 1,548 | 1,216 | 859 |
| fold 2 | 11,757 | 4,081 | 2,731 | 1,558 | 1,207 | 854 |
| fold 3 | 11,746 | 4,123 | 2,741 | 1,544 | 1,208 | 855 |

**fold间P450酶分布**：
- 4个fold训练集并集：**4,899个**（= data.csv全量P450酶）
- 4个fold训练集交集：**1,726个**（所有fold都包含的P450酶）

### 4.3 P450正负样本分布

| 样本类型 | 数量 | 占P450总数比例 |
|---------|------|---------------|
| 正样本 (label=1) | 984 | 6.3% |
| 负样本 (label=0) | 14,711 | 93.7% |

### 4.3 Top 10 P450 EC号

| 排名 | EC号 | 条目数 |
|------|------|--------|
| 1 | 1.14.14.1 | 871 |
| 2 | 1.14.14.82 | 709 |
| 3 | 1.14.14.11 | 608 |
| 4 | 1.14.15.16 | 544 |
| 5 | 1.14.14.9 | 527 |
| 6 | 1.14.14.32 | 507 |
| 7 | 1.14.14.137 | 454 |
| 8 | 1.14.14.91 | 450 |
| 9 | 1.14.14.154 | 428 |
| 10 | 1.14.14.126 | 407 |

---

## 五、产出文件清单

| 文件名 | 内容 | 行数 |
|--------|------|------|
| `P450_enzymes_list.csv` | 全部P450酶列表（brenda全量） | 4,899 |
| `P450_in_training_set.csv` | **训练集中的P450酶列表（仅brenda）** | **4,121** |

### 文件格式

```csv
enzyme,ecnumber,uniprot_id,source
0,1.14.14.126,P07327,brenda
1,1.14.14.9,P00329,brenda
...
```

---

## 六、Benchmark建议

### 6.1 如何使用这些数据

```python
import pandas as pd

# 加载训练集P450列表
training_p450 = pd.read_csv('P450_in_training_set.csv')

# 检查目标酶是否在训练集中
target_uniprot = 'YOUR_TARGET_UNIPROT_ID'

if target_uniprot in training_p450['uniprot_id'].values:
    print("警告：此酶在训练集中，不应用于benchmark")
else:
    print("此酶可用于benchmark")
```

### 6.2 注意事项

- 本分析基于fold 0的训练/测试划分
- 训练集包含**4,121**个P450酶（仅brenda数据源）
- 建议对所有4个fold进行检查以确保完整性

---

## 七、校正记录

| 时间 | 内容 |
|------|------|
| 2025-12-31 02:20 | 初始报告（错误使用all_split数据） |
| 2025-12-31 02:47 | 第一次校正：使用random_split重新统计 |
| 2025-12-31 03:10 | 第二次校正：检查所有8个数据源 |
| 2025-12-31 03:30 | 第三次校正：补充测试集/验证集统计及重叠分析 |
| 2025-12-31 04:00 | 第四次校正：修正"800"为"778"（去重后） |
| **2025-12-31 04:30** | **第五次校正：删除halogenase（非P450，是FAD卤化酶）** |

### 校正历史对比

| 统计项 | 初始值 | 第一次 | 第二次 | 第三次 | 第四次 | **第五次** |
|--------|--------|-------|-------|-------|-------|-----------|
| 训练集P450条目 | 9,147 | 11,809 | ~~12,100~~ | ~~12,100~~ | ~~12,100~~ | **11,809** |
| 训练集独特P450酶 | 3,068 | 4,121 | ~~4,135~~ | ~~4,135~~ | ~~4,135~~ | **4,121** |
| 测试集独特P450酶 | - | - | - | ~~1,574~~ | ~~1,574~~ | **1,565** |
| 测试集训练集未见 | - | - | - | 558 | 558 | **558** |
| 验证集独特P450酶 | - | - | - | ~~838~~ | ~~838~~ | **833** |
| 验证集训练集未见 | - | - | - | 242 | 242 | **242** |
| 模型从未见过P450 | - | - | - | ~~800~~ | 778 | **778** |

---

## 八、结论

### 8.1 关键结论

1. **EZSpecificity训练数据确实包含P450酶**
2. 训练集共有 **4,121个独特的P450酶**（仅brenda数据源）
3. 其余7个数据源（Duf, Esterase, Gt_acceptor, Nitrilase, Phosphatase, Thiolase, halogenase）**不含P450酶**
4. halogenase中的EC 1.14.14.-酶是**FAD依赖型卤化酶**，不是P450
5. 使用EZSpecificity benchmark P450时**必须排除训练集中已见过的酶**

### 8.2 数据集重叠分析

**重要发现**：训练/测试/验证集中的P450酶存在大量重叠！

| 项目 | 数量 | 说明 |
|------|------|------|
| 测试集独特P450酶 | 1,565 | 仅brenda |
| 测试集与训练集重叠 | 1,007 (64.3%) | 这些酶模型已在训练中见过 |
| 测试集训练集未见 | **558** | **这些酶模型从未见过** |
| 验证集独特P450酶 | 833 | 仅brenda |
| 验证集与训练集重叠 | 591 (70.9%) | 这些酶模型已在训练中见过 |
| 验证集训练集未见 | **242** | **这些酶模型从未见过** |

**Benchmark候选**：测试集+验证集中共有 **778个P450酶** 模型从未见过（去重后），可作为公平benchmark的候选。

### 8.3 后续建议

1. [ ] 获取苄基异喹啉生物碱相关P450的UniProt ID列表
2. [ ] 与本报告中的训练集P450列表进行比对
3. [ ] 确定哪些P450可以用于benchmark
4. [ ] 如需更多未见过的P450作为benchmark，可从测试集/验证集中778个未见过的P450中筛选

---

## 九、阶段五：P450精确验证计划（新增 2025-12-31）

### 9.1 背景与动机

EC号筛选存在**假阳性风险**，例如：
- halogenase中的EC 1.14.14.-酶被错误识别为P450
- 实际上它们是FAD依赖型卤化酶，使用黄素（FAD）而非血红素（Heme）

**真正的P450酶必须含有Heme（铁-血红素）作为辅因子**，这是P450催化机制的核心。

### 9.2 验证方法

#### 方法1：UniProt蛋白家族验证
- 查询UniProt的`protein_families`字段
- P450应属于"Cytochrome P450 family"
- 查询`cofactors`字段是否包含"Heme"

```python
# API示例
GET https://rest.uniprot.org/uniprotkb/{uniprot_id}?fields=protein_families,cofactors
```

#### 方法2：InterPro域验证
- P450特征域：
  - IPR001128 - Cytochrome P450
  - IPR002401 - Cytochrome P450, E-class, group I
  - IPR036396 - Cytochrome P450 superfamily

#### 方法3：Heme结合位点验证
- P450 Heme结合基序特征：`FxxGx[RH]xCxG`
- 其中半胱氨酸是轴向配体，与Heme的铁原子配位

### 9.3 预期输出

| 分类 | 说明 |
|------|------|
| ✅ **确认P450** | 通过所有验证（UniProt家族 + InterPro域 + Heme基序） |
| ⚠️ **可能P450** | 部分验证通过，需人工审核 |
| ❌ **非P450** | 验证失败，确认为假阳性 |

**输出文件**：
- `P450_verified.csv` - 确认的P450酶
- `P450_uncertain.csv` - 需进一步审核的酶
- `P450_rejected.csv` - 确认非P450的酶（含排除原因）

### 9.4 状态

**当前状态**：计划阶段，待执行

