# EZSpecificity 数据文件结构详解（零基础友好版）

## 写在前面

本文档面向**完全没有接触过这个项目**的读者，用最通俗的语言解释每个数据文件的结构和含义。

---

## 一、什么是"酶-底物对"？

在开始理解数据之前，先了解一个核心概念：

- **酶（Enzyme）**：一种蛋白质，能催化特定的化学反应
- **底物（Substrate）**：酶作用的对象，即被酶催化转化的分子
- **酶-底物对**：一个酶和它能作用的底物配对在一起

**举例**：
- 酶：唾液淀粉酶
- 底物：淀粉
- 这就是一个"酶-底物对"：唾液淀粉酶能催化淀粉分解

EZSpecificity的任务就是：**给定一个酶和一个分子，预测这个酶能否催化这个分子**。

---

## 二、三个核心数据文件

EZSpecificity使用三个主要的CSV文件来存储数据：

```
ESIBank/brenda/
├── enzymes.csv    → 存储所有酶的信息（"酶的名册"）
├── data.csv       → 存储酶-底物对的关系（"配对名单"）
└── reaction.csv   → 存储所有底物/反应信息（"底物字典"）
```

下面逐一讲解。

---

## 三、enzymes.csv - 酶的名册

### 3.1 文件用途
这个文件就像一本"酶的通讯录"，记录了每一个酶的详细信息。

### 3.2 文件结构

| 列名 | 通俗解释 | 示例 |
|------|---------|------|
| `sequences` | 酶的"身份证"——氨基酸序列 | `MSTAGKVIKCKAAVLWELKK...` |
| `uniprots` | 酶在UniProt数据库的ID（相当于身份证号） | `P07327` |

### 3.3 看一个例子

```csv
sequences,uniprots
MSTAGKVIKCKAAVLWELKKPFSIEEVEVAPPKAHEVRIKMVAVGICGTD...,P07327
MSTAGKVIKCKAAVLWELHKPFTIEDIEVAPPKAHEVRIKMVATGVCRSD...,P00329
```

**解读**：
- 第1行（表头后）：
  - 这是一个酶，它的氨基酸序列以`MSTAGKVIKC...`开头
  - 它在UniProt数据库的ID是`P07327`
  - 这一行的**行号是0**（程序从0开始数）

### 3.4 重要概念：酶索引

在后面的`data.csv`中，会用**行号**来指代酶，而不是直接写序列。比如：
- "enzyme = 0" 表示 enzymes.csv 的第1行（P07327）
- "enzyme = 5138" 表示 enzymes.csv 的第5139行

这样做是为了节省存储空间——序列很长，数字很短。

---

## 四、reaction.csv - 底物字典

### 4.1 文件用途
存储所有化学反应和底物的信息。

### 4.2 文件结构

| 列名 | 通俗解释 | 示例 |
|------|---------|------|
| `reactions` | 完整的化学反应（底物>>产物） | `O=C(O)CCC...>>O=CCCC...` |
| `substrates` | 单独的底物分子 | `O=C(O)CCCCCCCCCCCO` |

### 4.3 关于SMILES

`O=C(O)CCCCCCCCCCCO` 这样的字符串叫做**SMILES**，是化学家用来描述分子结构的一种文字表示法。

**简单理解**：
- `C` = 碳原子
- `O` = 氧原子
- `=` = 双键
- `(O)` = 侧链

---

## 五、data.csv - 配对名单（最重要！）

### 5.1 文件用途
这是**核心数据文件**，记录了每一个"酶-底物对"的详细信息。

### 5.2 文件结构

| 列名 | 通俗解释 | 值的含义 |
|------|---------|---------|
| `enzyme` | 酶的索引号 | 指向enzymes.csv的第几行 |
| `reaction` | 反应的索引号 | 指向reaction.csv的第几行 |
| `label` | 这个配对是真是假？ | 1=真的能反应，0=假的不能反应 |
| `ecnumber` | 酶的分类号 | 如`1.14.14.1`表示P450酶 |
| `difficulty` | 负样本的"迷惑程度" | 0-4（越高越难区分），正样本为-1 |
| `fake_ecnumber` | 负样本的EC号 | 用于记录负样本来自哪类酶 |
| `structure_index` | 3D结构索引 | -1表示没有3D结构 |

### 5.3 看一个完整例子

```csv
enzyme,reaction,label,ecnumber,difficulty,fake_ecnumber,structure_index
7894,13109,1,2.3.1.84,-1,2.3.1.84,-1
15164,33122,0,3.5.2.6,1,3.2.1.3,203913
```

**逐行解读**：

**第1行**（正样本）：
- `enzyme=7894`：去enzymes.csv找第7895行的酶
- `reaction=13109`：去reaction.csv找第13110行的底物
- `label=1`：✅ 这个酶**真的能**催化这个底物
- `ecnumber=2.3.1.84`：这个酶的EC分类号
- `difficulty=-1`：正样本，无难度概念
- `structure_index=-1`：没有3D结构信息

**第2行**（负样本）：
- `enzyme=15164`：去enzymes.csv找第15165行的酶
- `reaction=33122`：去reaction.csv找第33123行的底物
- `label=0`：❌ 这个酶**不能**催化这个底物
- `ecnumber=3.5.2.6`：这个底物本来是给EC 3.5.2.6酶的
- `difficulty=1`：迷惑程度1（EC号前1位相同）
- `fake_ecnumber=3.2.1.3`：负样本酶的EC号
- `structure_index=203913`：有3D结构，索引是203913

---

## 六、数据之间的关系图

```
            ┌─────────────────────┐
            │   enzymes.csv       │
            │  "酶的名册"          │
            │  行0: P07327        │
            │  行1: P00329        │
            │  ...                │
            │  行5138: P37120     │  ◀─── P450酶！
            └──────────┬──────────┘
                       │
                       │ enzyme索引指向
                       ▼
┌──────────────────────────────────────────────────────┐
│                    data.csv                          │
│                 "配对名单"                            │
│                                                      │
│  enzyme=5138, reaction=9231, label=1, ec=1.14.14.81  │
│  ────────────────────────────────────────────────    │
│  这表示：酶5138（P37120）和底物9231是真实配对        │
│  而且这是一个P450酶（EC 1.14.14.81）                 │
└──────────────────────────────────────────────────────┘
                       │
                       │ reaction索引指向
                       ▼
            ┌─────────────────────┐
            │   reaction.csv      │
            │  "底物字典"          │
            │  行9231: CC(=O)...  │
            └─────────────────────┘
```

---

## 七、如何识别P450酶？

### 7.1 什么是EC号？

EC号是**酶的分类编号**，由4个数字组成，如`1.14.14.1`：
- 第1位：大类（1=氧化还原酶）
- 第2位：亚类（14=作用于配对供体）
- 第3位：亚亚类（14=以NADH等为供体）
- 第4位：具体编号

### 7.2 P450酶的EC号

**P450酶（细胞色素P450单加氧酶）** 的EC号范围：
- `1.14.14.*` — 以成对供体作用的单加氧酶
- `1.14.15.*` — 以NADH/NADPH为供体的单加氧酶

### 7.3 如何从data.csv找P450？

只需筛选`ecnumber`列以`1.14.14.`或`1.14.15.`开头的行：

```bash
# 命令示例
grep -E "1\.14\.14\.|1\.14\.15\." data.csv
```

**结果统计**：
- 找到 **15,695条** P450相关的酶-底物对
- 涉及 **4,899个** 独特的P450酶

---

## 八、训练集/测试集划分

**⚠️ 校正说明（2025-12-31 03:10）**：模型实际使用`random_split/`目录，非`all_split/`

数据被分成多个部分用于模型训练和评估：

```
ESIBank/brenda/random_split/       ← 正确目录
├── training_datas_0.csv   → 训练集（约44万行）
├── val_datas_0.csv        → 验证集（约4.4万行）
└── testing_datas_0.csv    → 测试集（约10万行）
```

**文件格式与data.csv完全相同**，只是数据被分开了。

### P450在各数据集中的分布（已校正 2025-12-31 04:30）

**⚠️ 注意：第五次校正，删除halogenase（非P450，是FAD依赖型卤化酶）**

| 数据集 | P450条目 | 独特P450酶 | 与训练集重叠 | 训练集未见 |
|--------|---------|-----------|-------------|-----------|
| 训练集 | 11,809 | 4,121 | - | - |
| 测试集 | 2,705 | 1,565 | 1,007 | 558 |
| 验证集 | 1,181 | 833 | 591 | 242 |

**关键发现**：测试集/验证集中共有 **778个P450酶** 模型从未见过（558+242去重后），可作为公平benchmark候选。

**所有fold的P450统计（补充信息）：**

| Fold | 训练集条目 | 训练集独特酶 | 测试集条目 | 测试集独特酶 | 验证集条目 | 验证集独特酶 |
|------|-----------|-------------|-----------|-------------|-----------|-------------|
| **fold 0** | **11,809** | **4,121** | **2,705** | **1,565** | **1,181** | **833** |
| fold 1 | 11,773 | 4,098 | 2,706 | 1,548 | 1,216 | 859 |
| fold 2 | 11,757 | 4,081 | 2,731 | 1,558 | 1,207 | 854 |
| fold 3 | 11,746 | 4,123 | 2,741 | 1,544 | 1,208 | 855 |

**说明**：模型（run_0）只使用了fold 0进行训练，上表中fold 0以粗体标记。4个fold训练集并集=4,899个P450酶，交集=1,726个。

---

## 九、快速参考卡片

### 想找某个酶的信息？
1. 知道UniProt ID（如`P37120`）→ 在`enzymes.csv`的`uniprots`列搜索
2. 找到对应行号（如第5139行）→ 酶索引是5138（从0开始）
3. 在`data.csv`的`enzyme`列搜索5138 → 找到所有相关配对

### 想找P450酶？
1. 在`data.csv`的`ecnumber`列搜索`1.14.14.`或`1.14.15.`
2. 获取对应的`enzyme`索引
3. 去`enzymes.csv`查看具体的序列和UniProt ID

### 想知道某个配对是否真实？
- 看`data.csv`的`label`列：1=真实配对，0=虚构配对

---

## 十、常见问题

**Q: 为什么有负样本？**
A: 模型需要学会区分"能反应"和"不能反应"，所以需要正反两种例子。

**Q: difficulty是什么意思？**
A: 表示负样本与真实酶的相似程度。越高意味着这个假酶与真酶越相似，越难区分。

**Q: structure_index为什么有些是-1？**
A: -1表示没有这个酶-底物复合物的3D结构。有些有结构（正数），有些没有。

**Q: 为什么用索引而不是直接写酶序列？**
A: 酶序列很长（几百个字符），用数字索引更节省空间。

---

## 附录：关键统计数据（已校正 2025-12-31 04:30）

| 项目 | 数量 |
|------|------|
| 总酶数（brenda） | 25,225 |
| 总酶-底物对数（brenda） | 586,515 |
| P450酶-底物对数（brenda） | 15,695 |
| 独特P450酶数（brenda） | 4,899 |
| **训练集P450条目** | **11,809** |
| **训练集独特P450酶** | **4,121** |
| **测试集独特P450酶** | **1,565** |
| **测试集与训练集重叠P450酶** | **1,007** |
| **测试集训练集未见P450酶** | **558** |
| **验证集独特P450酶** | **833** |
| **验证集与训练集重叠P450酶** | **591** |
| **验证集训练集未见P450酶** | **242** |
| **模型从未见过的P450酶总数** | **778** |
