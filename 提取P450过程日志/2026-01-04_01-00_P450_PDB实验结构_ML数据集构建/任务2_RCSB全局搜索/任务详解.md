# 任务2详解：RCSB全局P450搜索

## 一句话总结

从全球最大的蛋白质结构数据库RCSB中，**找出所有有实验结构的P450酶**。结果：找到 **1,591个** P450结构实体。

---

## 背景知识

### 什么是RCSB数据库？

**RCSB**（Research Collaboratory for Structural Bioinformatics）是目前全世界最大、最权威的蛋白质3D结构数据库。

想象它是一个**巨大的图书馆**：
- 收藏了20多万本"蛋白质结构图书"
- 每本书记录一个蛋白质的精确3D形状
- 全世界科学家都在往这个图书馆贡献新的结构

### 如何确定一个蛋白质是P450？

这是本任务的核心问题。我们使用两种权威的"身份标识"：

| 标识类型 | 标识号 | 含义 |
|----------|--------|------|
| **PFAM** | PF00067 | Pfam数据库中的P450家族标识 |
| **InterPro** | IPR001128 | InterPro数据库的P450核心结构域 |
| **InterPro** | IPR036396 | InterPro数据库的P450超家族 |
| **InterPro** | IPR002401 | InterPro数据库的P450 E-class分类 |

**为什么不用文字搜索"P450"或"cytochrome"？**

因为文字搜索会产生大量假阳性（把不是P450的蛋白误认为是P450）。而PFAM和InterPro是基于**序列和结构特征**的精准分类，可靠性更高。

### 什么是"polymer entity"（聚合物实体）？

一个PDB结构文件可能包含多条蛋白质链。每条独特的蛋白质链就是一个"entity"（实体）。

例如：`4I0B_1` 表示PDB编号4I0B结构中的第1个蛋白质实体。

---

## 任务目标

1. **搜索**：从RCSB数据库找出所有带有P450标识的蛋白质结构
2. **收集元数据**：获取每个结构的详细信息（分辨率、物种、序列、配体等）
3. **分类统计**：按物种来源分类统计

---

## 执行过程

### 第一步：基于PFAM和InterPro搜索

向RCSB的搜索API发送请求，查找带有以下注释的蛋白质：

```
查询1: PFAM = "PF00067"     → 找到约1500个实体
查询2: InterPro = "IPR001128" → 找到约1400个实体
查询3: InterPro = "IPR036396" → 找到约1500个实体
查询4: InterPro = "IPR002401" → 找到约800个实体
```

**合并去重后**：共发现 **1,591个** 独特的P450聚合物实体。

### 第二步：获取详细元数据

对每个P450实体，通过RCSB的GraphQL API获取：

| 信息类型 | 说明 |
|----------|------|
| `resolution` | 结构分辨率（越小越清晰） |
| `experimental_method` | 实验方法（X射线、冷冻电镜等） |
| `organism_name` | 来源物种名称 |
| `ncbi_taxonomy_id` | NCBI物种分类编号 |
| `uniprot_ids` | UniProt蛋白质标识符 |
| `sequence` | 氨基酸序列 |
| `ligands` | 结构中绑定的小分子/配体 |

### 第三步：物种分类

根据物种信息，将P450分为5大类：

```
分类规则：
- mammals（哺乳动物）：人、小鼠、大鼠、猪、牛等
- bacteria（细菌）：大肠杆菌、枯草杆菌、链霉菌等
- fungi（真菌）：酵母、曲霉等
- plants（植物）：拟南芥、水稻、烟草等
- other（其他）：昆虫、原生动物等
```

### 第四步：保存结果

将所有数据保存到SQLite数据库（支持断点续传），然后导出为CSV文件。

---

## 执行结果

### 总览统计

| 指标 | 数值 |
|------|------|
| 搜索到的P450实体总数 | **1,591个** |
| 对应的唯一PDB结构数 | **约1,200个** |
| 有配体/底物的 | 约1,100个 |

### 物种分布

| 物种类别 | 数量 | 占比 |
|----------|------|------|
| bacteria（细菌） | ~800个 | ~50% |
| mammals（哺乳动物） | ~400个 | ~25% |
| other（其他） | ~200个 | ~13% |
| fungi（真菌） | ~100个 | ~6% |
| plants（植物） | ~50个 | ~3% |
| unknown（未知） | ~40个 | ~3% |

**有趣发现**：细菌P450占了一半！这是因为：
- 细菌P450更容易表达和结晶（实验难度低）
- 细菌P450是药物研发的热门靶点
- 一个经典的模式P450（P450-cam）来自恶臭假单胞菌

---

## 技术细节

### 使用的API

```python
# 搜索API - 查找P450实体
RCSB_SEARCH_API = "https://search.rcsb.org/rcsbsearch/v2/query"

# GraphQL API - 获取详细元数据
RCSB_GRAPHQL_API = "https://data.rcsb.org/graphql"
```

### 为什么用SQLite数据库？

API查询需要时间，如果中途网络中断，直接保存到CSV会丢失进度。

SQLite数据库支持**断点续传**：
- 每批查询结果立即存入数据库
- 程序重启后可以跳过已完成的部分
- 最后统一导出为CSV

---

## 输出文件说明

| 文件名 | 内容 |
|--------|------|
| `全部P450结构_1591个.csv` | 所有P450实体的完整数据 |
| `P450_细菌.csv` | 细菌来源的P450 |
| `P450_哺乳动物.csv` | 哺乳动物来源的P450 |
| `P450_真菌.csv` | 真菌来源的P450 |
| `P450_植物.csv` | 植物来源的P450 |
| `P450_其他物种.csv` | 其他物种来源的P450 |
| `P450全局搜索_缓存数据库.db` | SQLite缓存数据库 |

---

## 关键发现

1. **RCSB数据库中有大量P450实验结构**：1,591个实体，远超ESIBank的389个P450

2. **物种分布不均衡**：细菌和哺乳动物P450占绝大多数，植物P450很少

3. **这些结构与ESIBank完全不同**：
   - RCSB的P450有**实验解析的3D结构**
   - ESIBank的389个P450**没有任何实验结构**，只有序列和功能注释
   - 这是两个完全不重叠的数据集！

---

## 与任务1的对比

| 对比项 | 任务1（ESIBank P450） | 任务2（RCSB P450） |
|--------|----------------------|-------------------|
| 数据来源 | ESIBank论文数据库 | RCSB全球结构数据库 |
| P450数量 | 389个 | 1,591个 |
| 有实验结构 | **0个** | **1,591个** |
| 选择标准 | 有底物特异性注释 | 有晶体结构 |
| 结构来源 | AlphaFold预测 | X射线/冷冻电镜实验 |

**核心结论**：ESIBank选择P450的标准是"功能信息完整"，而不是"有实验结构"。这导致了两个数据集完全不重叠。

